@using eTickets.Data.View_Models
@model ShoppingCartVM

@{

    ViewData["Title"] = "Order summary";

}

<div class="row">
    <div class="col-md-8 offset-2">
        <div class="text-center">

            <h2 class="mb-4">Your Order Summary</h2>

        </div>
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Selected amount</th>
                    <th>Movie</th>
                    <th>Price</th>
                    <th>SubTotal</th>
                    <th></th>
                </tr>

            </thead>

            <tbody>
                @foreach (var item in Model.ShoppingCart.ShoppingCartItems)
                {
                    <tr>
                        <td class="align-middle">
                            @item.Amount
                        </td>
                        <td class="align-middle">
                            @item.Movie.Name
                        </td>
                        <td class="align-middle">
                            $@item.Movie.Price
                        </td>
                        <td class="align-middle">
                            $@(item.Amount* item.Movie.Price)
                        </td>
                        <td class="align-middle">
                            <a class="text-danger" asp-controller="Orders" asp-action="RemoveItemShoppingCart" asp-route-id="@item.Movie.ID"> <i class="bi bi-cart-dash"></i></a>

                            <a class="text-success" asp-controller="Orders" asp-action="AddToShoppingCart" asp-route-id="@item.Movie.ID"> <i class="bi bi-cart-plus"></i></a>
                        </td>
                    </tr>
                }
            </tbody>

            <tfoot>
                <tr>
                    <td colspan="2"> </td>
                    <td><b>Total:</b></td>
                    <td>@Model.ShoppingCartTotal.ToString("c")</td>
                    <td></td>

                </tr>
            </tfoot>

        </table>
        <div class="text-center mt-3">

            <div id="paypal-btn" style="max-width: 360px; margin: 0 auto;"></div>

            <div class="text-muted my-2">or</div>

            <a class="btn btn-outline-success px-4"
               asp-controller="Movies"
               asp-action="Index">
                Add More Items
            </a>

        </div>





    </div>
</div>
@section Scripts {
    <script src="https://www.paypal.com/sdk/js?client-id=Aao5LYxwtsSdLSvwxs4dOcIjAtgfuL_F7wlCxz-L3HmtncPOsW9rCzJOz5p6XsNrJGZ_JIReDWK6XPyB&currency=USD"></script>
    <script>
        paypal.Buttons({
            createOrder: function (data, actions) {
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: '@Model.ShoppingCartTotal'
                        }
                    }]
                });
            },
            onApprove: function (data, actions) {
                return actions.order.capture().then(function (details) {
                    console.log(details);
                    window.location.href = '/Orders/CompleteOrder';
                });
            },
            onError: function (err) {
                console.error(err);
            }
        }).render('#paypal-btn');
    </script>
}